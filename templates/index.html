<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Aula de Armon√≠a</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg?v=1">
    <link rel="apple-touch-icon" href="/static/favicon.svg?v=1">
    <!-- Estilos -->
    <link rel="stylesheet" href="/static/css/styles.css">
    <!-- VexFlow para notaci√≥n musical -->
    <script src="https://cdn.jsdelivr.net/npm/vexflow@4.2.2/build/cjs/vexflow.js"></script>
</head>
<body>

    <!-- MODAL ONBOARDING -->
    <div class="modal-overlay" id="modal-welcome">
        <div class="modal-content">
            <h2>Bienvenido a Aula de Armon√≠a</h2>
            <p>Escribe acordes de 4 voces (SATB) y obt√©n an√°lisis autom√°tico de reglas de armon√≠a tonal.</p>
            <div class="shortcuts-list">
                <p style="margin: 0 0 8px 0; font-weight: bold; font-size: 0.9rem;">Atajos de teclado:</p>
                <div class="shortcut">
                    <span>Seleccionar voces:</span>
                    <span><kbd>1</kbd> <kbd>2</kbd> <kbd>3</kbd> <kbd>4</kbd></span>
                </div>
                <div class="shortcut">
                    <span>Navegar:</span>
                    <span><kbd>‚Üê</kbd> <kbd>‚Üí</kbd></span>
                </div>
                <div class="shortcut">
                    <span>Notas (A-G) + Octava:</span>
                    <span><kbd>C</kbd> <kbd>D</kbd> <kbd>E</kbd>...</span>
                </div>
                <div class="shortcut">
                    <span>Borrar nota:</span>
                    <span><kbd>Backspace</kbd></span>
                </div>
                <div class="shortcut">
                    <span>Analizar:</span>
                    <span><kbd>Enter</kbd></span>
                </div>
                <div class="shortcut">
                    <span>Deshacer/Rehacer:</span>
                    <span><kbd>Ctrl</kbd>+<kbd>Z</kbd> / <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Z</kbd></span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn-modal btn-modal-secondary" onclick="AudioStudio.closeWelcome()">M√°s tarde</button>
                <button class="btn-modal btn-modal-primary" onclick="AudioStudio.closeWelcome()">Comenzar</button>
            </div>
        </div>
    </div>

    <header>
        <h1>Aula de Armon√≠a</h1>
        <div class="header-controls">
            <!-- Toggle Modo -->
            <div class="mode-toggle">
                <button id="btn-mode-write" class="active" onclick="AudioStudio.setAppMode('write')"><span class="btn-icon">‚úèÔ∏è</span><span class="btn-text"> Escribir</span></button>
                <button id="btn-mode-review" onclick="AudioStudio.setAppMode('review')"><span class="btn-icon">üîç</span><span class="btn-text"> Revisar</span></button>
            </div>
            <button class="btn-undo" id="btn-undo" onclick="AudioStudio.undo()" data-tooltip="Deshacer (Ctrl+Z)" disabled>‚Ü∂</button>
            <button class="btn-redo" id="btn-redo" onclick="AudioStudio.redo()" data-tooltip="Rehacer (Ctrl+Shift+Z)" disabled>‚Ü∑</button>
            <label class="auto-flow-switch write-only">
                <input type="checkbox" id="chk-autoflow" checked> Auto
            </label>
            <div class="input-switch write-only">
                <label>Entrada</label>
                <select id="input-mode" onchange="AudioStudio.setInputMode(this.value)">
                    <option value="piano">Piano</option>
                    <option value="buttons">Botones</option>
                </select>
            </div>
        </div>
    </header>

    <section id="stage">
        <div class="scroll-partitura" id="contenedor-scroll">
            <div id="lienzo-partitura"></div>
            <div id="tooltip-error"></div>
        </div>
    </section>

    <section id="deck">
        <!-- Panel Resultados -->
        <div id="panel-resultados">
            <div id="resumen-errores" class="error-header">Informe</div>
            <div id="lista-errores"></div>
        </div>

        <!-- Fila A -->
        <div class="toolbar-row">
            <div class="nav-group">
                <button class="btn-nav" onclick="moverCursor(-1)" data-tooltip="Anterior (‚Üê)">‚ùÆ</button>
                <div id="indicador-posicion">C.1 - T.1</div>
                <button class="btn-nav" onclick="moverCursor(1)" data-tooltip="Siguiente (‚Üí)">‚ùØ</button>
            </div>
            <div class="voices-group">
                <button class="btn-voz" id="btn-B" data-key="1" onclick="seleccionarVoz('B')" data-tooltip="Bajo (1)">B</button>
                <button class="btn-voz" id="btn-T" data-key="2" onclick="seleccionarVoz('T')" data-tooltip="Tenor (2)">T</button>
                <button class="btn-voz" id="btn-A" data-key="3" onclick="seleccionarVoz('A')" data-tooltip="Contralto (3)">A</button>
                <button class="btn-voz" id="btn-S" data-key="4" onclick="seleccionarVoz('S')" data-tooltip="Soprano (4)">S</button>
            </div>
        </div>

        <!-- Fila B -->
        <div class="piano-row">
            <!-- Modo Botones (m√≥vil) -->
            <div id="mobile-input-grid" class="mobile-input-grid">
                <div class="row">
                    <button class="btn-note" onclick="AudioStudio.inputNote('C')">Do</button>
                    <button class="btn-note" onclick="AudioStudio.inputNote('D')">Re</button>
                    <button class="btn-note" onclick="AudioStudio.inputNote('E')">Mi</button>
                    <button class="btn-note" onclick="AudioStudio.inputNote('F')">Fa</button>
                    <button class="btn-note" onclick="AudioStudio.inputNote('G')">Sol</button>
                    <button class="btn-note" onclick="AudioStudio.inputNote('A')">La</button>
                    <button class="btn-note" onclick="AudioStudio.inputNote('B')">Si</button>
                </div>
                <div class="row">
                    <button id="btn-alt-sharp" class="btn-alt" onclick="AudioStudio.setAlteracion('#')">‚ôØ</button>
                    <button id="btn-alt-flat" class="btn-alt" onclick="AudioStudio.setAlteracion('b')">‚ô≠</button>
                    <button id="btn-alt-natural" class="btn-alt active" onclick="AudioStudio.setAlteracion('n')">‚ôÆ</button>
                </div>
                <div class="row">
                    <span class="ctrl-label">Oct</span>
                    <button class="btn-mini" onclick="AudioStudio.changeOctave(-1)">‚àí</button>
                    <span id="mobile-octava" class="oct-display">3</span>
                    <button class="btn-mini" onclick="AudioStudio.changeOctave(1)">+</button>
                </div>
            </div>
            <div class="side-controls">
                <div class="ctrl-capsule">
                    <span class="ctrl-label">Oct</span>
                    <button class="btn-mini" onclick="cambiarOctava(-1)" data-tooltip="Oct -">‚àí</button>
                    <span id="display-octava" style="font-weight:bold; font-size:0.9rem; width:15px; text-align:center;">3</span>
                    <button class="btn-mini" onclick="cambiarOctava(1)" data-tooltip="Oct +">+</button>
                </div>
            </div>

            <div class="piano-container">
                <div class="piano-wrapper">
                    <div class="white-keys">
                        <div class="key-white" id="key-C" onclick="tocarBlanca('C')"><span>Do</span></div>
                        <div class="key-white" id="key-D" onclick="tocarBlanca('D')"><span>Re</span></div>
                        <div class="key-white" id="key-E" onclick="tocarBlanca('E')"><span>Mi</span></div>
                        <div class="key-white" id="key-F" onclick="tocarBlanca('F')"><span>Fa</span></div>
                        <div class="key-white" id="key-G" onclick="tocarBlanca('G')"><span>Sol</span></div>
                        <div class="key-white" id="key-A" onclick="tocarBlanca('A')"><span>La</span></div>
                        <div class="key-white" id="key-B" onclick="tocarBlanca('B')"><span>Si</span></div>
                        <div class="key-white" onclick="tocarDoAgudo()"><span>Do+</span></div>
                    </div>
                    <div class="key-black kb-Cs" id="key-C#" onclick="tocarNegra('C', 'D')"></div>
                    <div class="key-black kb-Ds" id="key-D#" onclick="tocarNegra('D', 'E')"></div>
                    <div class="key-black kb-Fs" id="key-F#" onclick="tocarNegra('F', 'G')"></div>
                    <div class="key-black kb-Gs" id="key-G#" onclick="tocarNegra('G', 'A')"></div>
                    <div class="key-black kb-As" id="key-A#" onclick="tocarNegra('A', 'B')"></div>
                </div>
            </div>

            <div class="side-controls">
                <div class="ctrl-capsule">
                    <div class="switch-alt">
                        <label><input type="radio" name="alt" value="#" onchange="AudioStudio.setAlteracion('#')"><span>‚ôØ</span></label>
                        <label><input type="radio" name="alt" value="b" onchange="AudioStudio.setAlteracion('b')"><span>‚ô≠</span></label>
                        <label><input type="radio" name="alt" value="n" checked onchange="AudioStudio.setAlteracion('n')"><span>‚ôÆ</span></label>
                    </div>
                </div>
            </div>
        </div>

        <div class="action-bar">
            <button class="btn-main btn-trash write-only" onclick="borrarTodo()" data-tooltip="Borrar todo (Ctrl+Shift+A)">üóëÔ∏è Borrar</button>
            <button class="btn-main btn-check write-only" id="btn-corregir" onclick="analizarPartitura()" data-tooltip="Analizar (Enter)">üîç Corregir</button>
            <button class="btn-main btn-check review-only" onclick="AudioStudio.setAppMode('write')" style="background: var(--primary);">‚úèÔ∏è Volver a Escribir</button>
        </div>
    </section>

    <!-- JavaScript de la aplicaci√≥n -->
    <script src="/static/js/app.js"></script>
</body>
</html>
